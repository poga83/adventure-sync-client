<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ß–∞—Ç</title>
    <style>
        /* –°—Ç–∏–ª–∏, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ (—É–±—Ä–∞–Ω—ã –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) */
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="sidebar" id="sidebar">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="user-profile">
                <div class="user-avatar" id="currentUserAvatar">–Ø</div>
                <div id="currentUserName">–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                <div id="userStatus" style="font-size:12px;opacity:0.8;">–û–Ω–ª–∞–π–Ω</div>
            </div>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤‚Ä¶" id="contactSearch">
            </div>
            <div class="contacts-list" id="contactsList">
                <div class="contact-item" data-contact="alice">
                    <div class="contact-avatar">–ê</div>
                    <div class="contact-info">
                        <div class="contact-name">–ê–ª–∏—Å–∞</div>
                        <div class="contact-status">–ü–µ—á–∞—Ç–∞–µ—Ç‚Ä¶</div>
                    </div>
                    <div class="status-indicator status-online"></div>
                </div>
                <!-- –î—Ä—É–≥–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã -->
            </div>
        </div>
        <div class="chat-area">
            <div class="chat-header">
                <span class="chat-title" id="chatTitle">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ‚Ä¶</span>
                <div class="chat-actions">
                    <button class="action-btn" onclick="toggleTheme()">üåô</button>
                    <button class="action-btn" onclick="clearChat()">üóëÔ∏è</button>
                    <button class="action-btn" onclick="exportChat()">üì§</button>
                </div>
            </div>
            <div class="messages-container" id="messagesContainer">
                <!-- –î–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É -->
                <div class="no-chat-selected" id="noChatSelected">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ‚Ä¶</div>
            </div>
            <div class="typing-indicator" id="typingIndicator" style="display:none;">–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ –ø–µ—á–∞—Ç–∞–µ—Ç‚Ä¶</div>
            <div class="input-container" id="inputContainer" style="display:none;">
                <!-- –ü–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è -->
            </div>
            <div class="emoji-picker" id="emojiPicker"><div class="emoji-grid" id="emojiGrid"></div></div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç —Å defer -->
    <script defer>
        let currentContact = null, messages = {}, isRecording = false, mediaRecorder = null;
        document.addEventListener('DOMContentLoaded', initializeApp);

        function initializeApp() {
            // –£–±–∏—Ä–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ‚Ä¶¬ª
            document.getElementById('chatTitle').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—â–µ–Ω–∏—è';
            document.getElementById('noChatSelected').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—â–µ–Ω–∏—è';
            loadEmojiPicker();
            setupEventListeners();
            loadMessagesFromStorage();
            setupVoiceRecording();
        }

        function setupEventListeners() {
            document.getElementById('contactSearch').addEventListener('input', e => filterContacts(e.target.value));
            document.addEventListener('click', e => {
                if (e.target.closest('.contact-item')) {
                    selectContact(e.target.closest('.contact-item').dataset.contact);
                }
                if (!e.target.closest('.emoji-picker') && !e.target.closest('[onclick="toggleEmojiPicker()"]')) {
                    document.getElementById('emojiPicker').classList.remove('show');
                }
            });
            document.getElementById('messageInput')?.addEventListener('keydown', e => {
                if (e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}
            });
            document.getElementById('messageInput')?.addEventListener('input', showTypingIndicator);
            window.addEventListener('resize', () => {
                if (window.innerWidth>768) document.getElementById('sidebar').classList.remove('show');
            });
        }

        function selectContact(contactId) {
            document.querySelectorAll('.contact-item').forEach(i=>i.classList.remove('active'));
            document.querySelector(`[data-contact="${contactId}"]`).classList.add('active');
            currentContact=contactId;
            document.getElementById('chatTitle').textContent=getContactName(contactId);
            document.getElementById('inputContainer').style.display='block';
            document.getElementById('noChatSelected').style.display='none';
            loadMessages(contactId);
            if(window.innerWidth<=768) document.getElementById('sidebar').classList.remove('show');
        }

        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: sendMessage, displayMessage, loadMessages, simulateReply,
           loadEmojiPicker, toggleEmojiPicker, insertEmoji, setupVoiceRecording,
           toggleVoiceRecording, showTypingIndicator, filterContacts,
           clearChat, exportChat, toggleTheme, toggleSidebar,
           showMessageContextMenu, replyToMessage, forwardMessage,
           addReaction, deleteMessage, getContactName, formatTime,
           scrollToBottom, saveMessagesToStorage, loadMessagesFromStorage */
        // (–°–º. –ø–æ–ª–Ω—ã–π –∫–æ–¥ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏)
    </script>
</body>
</html>
