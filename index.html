// В функции updateStatus() замените код на:
function updateStatus() {
    const newStatus = document.getElementById('status-select').value;
    if (newStatus !== currentUser.status) {
        currentUser.status = newStatus;
        
        // Отправляем обновленные данные на сервер
        socket.emit('register', currentUser);
        
        // Если геолокация активна - немедленно обновляем маркер
        if (isLocationTracking && userMarker) {
            updateMyMarker(currentUser.position);
        }
        
        addSystemMessage(`Статус изменен на: ${newStatus}`);
    }
}

// В функцию updateMyMarker() добавьте:
function updateMyMarker(coords) {
    const color = statusColors[currentUser.status] || '#007bff';
    const emoji = currentUser.status.split(' ')[0];
    
    const newIcon = L.divIcon({
        html: `<div style="
            background: ${color}; 
            color: white; 
            padding: 5px; 
            border-radius: 50%; 
            width: 35px; 
            height: 35px; 
            text-align: center; 
            line-height: 25px; 
            box-shadow: 0 3px 8px rgba(0,0,0,0.4); 
            border: 3px solid white;
        ">${emoji}</div>`,
        iconSize: [35, 35],
        iconAnchor: [17, 17]
    });

    userMarker.setIcon(newIcon);
    userMarker.setPopupContent(`<b>${currentUser.name} (ты)</b><br>${currentUser.status}`);
}
